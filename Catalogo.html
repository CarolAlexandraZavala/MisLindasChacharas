<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <meta name="title" content="Catalogo">
  <meta name="description" content="Variedad de productos de excelente calidad, excelente costo y de los mejores materiales, innovando en la moda y el cuidado personal, queriendo resaltar la belleza de cada mujer">
  <meta name="keywords" content="Aretes, nube, antioxidante">
  <meta name="robots" content="noindex, nofollow">	
	<link rel="stylesheet" href="/static/css/styles-icons.css">
  <link rel="stylesheet" href="css/styles-icons.css">
	<link rel="stylesheet" href="/static/css/styles-index.css">
  <link rel="stylesheet" href="css/styles-index.css">
	<link rel="stylesheet" href="/static/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/css/crud.css">
  <link rel="stylesheet" href="css/crud.css">
	<link rel="stylesheet" href="/static/css/admin.css">
  <link rel="stylesheet" href="css/admin.css">
	<link rel="stylesheet" href="/static/css/estilos.css">
  <link rel="stylesheet" href="css/estilos.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link rel="productos" href="Productos.json">
	<link rel="icon" href="/static/img/Icono2.ico"/>
  <link rel="icon" href="img/Icono2.ico" type="image/png" />
  <script src="js/NavarResponsive.js"></script>

  <!-- Google Analytics -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-XDY927KX9Q');
  </script>

  <!-- Script de filtro de búsqueda -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const filterSelect = document.getElementById('filter');
      const cardsContainer = document.querySelector('.row');

      filterSelect.addEventListener('change', () => {
        const selectedOption = filterSelect.value;

        // Obtiene los elementos de las tarjetas
        const cards = Array.from(cardsContainer.getElementsByClassName('card'));

        // Ordena los elementos según la opción seleccionada
        switch (selectedOption) {
          case 'asc':
            cards.sort((a, b) => a.querySelector('h5').textContent.localeCompare(b.querySelector('h5').textContent));
            break;
          case 'desc':
            cards.sort((a, b) => b.querySelector('h5').textContent.localeCompare(a.querySelector('h5').textContent));
            break;
          case 'price-asc':
            sortCardsByPrice(cards, true);
            break;
          case 'price-desc':
            sortCardsByPrice(cards, false);
            break;
          default:
            // Predeterminado: mantener el orden original
            break;
        }

        // Vuelve a agregar las tarjetas al contenedor en el nuevo orden
        cards.forEach((card) => cardsContainer.appendChild(card));
      });

      function sortCardsByPrice(cards, ascending) {
        cards.sort((a, b) => {
          const priceA = parseFloat(a.querySelector('p').textContent.replace(/[^0-9.-]+/g, ''));
          const priceB = parseFloat(b.querySelector('p').textContent.replace(/[^0-9.-]+/g, ''));
          return ascending ? priceA - priceB : priceB - priceA;
        });
      }
    });

    function searchProducts() {
  const searchInput = document.getElementById('searchInput').value.toLowerCase();
  const cards = Array.from(document.querySelectorAll('.card'));

  // Filtra las tarjetas basándose en el nombre
  const filteredCards = cards.filter(card => {
    const productName = card.querySelector('h5').textContent.toLowerCase();
    return productName.includes(searchInput);
  });

  // Limpia el contenedor de productos antes de agregar los resultados de la búsqueda
  const cardsContainer = document.querySelector('.row');
  cardsContainer.innerHTML = '';

  // Agrega las tarjetas filtradas al contenedor
  filteredCards.forEach(card => cardsContainer.appendChild(card));
}
  </script>
  
  <title>MisLindasChacharas || Catalogo</title>
  <style>
    #cotizacion th, #cotizacion td {
      text-align: center;
    }
    #espacio {

      margin-top: 10px;
    }

    #imagenes {
      width: 250px;
      height: 300px;
      margin-left: 20%;
      margin-right: 20%;
    }

    #diseño {
      font-size: 15px;
      margin-left: 20px;
      text-align: center;
      padding-bottom: 5px;
      width: 440px;
      height: 440px;
    }

    #tablaPersonas {

      margin-top: 20px;

    }

    .center-container {
      display: flex;
      justify-content: center;
      align-items: center;

    }
  </style>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

</head>

<body>
  <header>
    <div class="navbar navbar-expand-lg navbar-dark" style="background-color: rgb(133, 71, 122);">
      <div class="container">
        <a href="index.html" class="navbar-brand" title="index">
          <strong>MisLindasChacharas</strong>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarHeader"
          aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
  
        <div class="collapse navbar-collapse" id="navbarHeader">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a href="index.html" class="nav-link active" title="index">Inicio</a>
            </li>
            <li class="nav-item">
              <a href="Aretes.html" class="nav-link active" title="aretes">Aretes</a>
            </li>
            <li class="nav-item">
              <a href="Collares.html" class="nav-link active" title="collares">Collares</a>
            </li>
            <li class="nav-item">
              <a href="Cuidado Personal.html" class="nav-link active" title="cuidado">Cuidado personal</a>
            </li>
            <li class="nav-item">
              <a href="Ropa.html" class="nav-link active" title="ropa">Ropa</a>
            </li>
          </ul>
  
          <form target="paypal" action="https://www.paypal.com/cgi-bin/webscr" method="post">
            <input type="hidden" name="cmd" value="_s-xclick">
            <input type="hidden" name="encrypted"
              value="-----BEGIN PKCS7-----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-----END PKCS7-----">
              <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_viewcart_SM.gif" border="0"
                name="submit" alt="PayPal, la forma más segura y rápida de pagar en línea">
              <input type="text" id="searchInput" class="form-control" placeholder="Buscar productos...">
              <button type="button" id="searchButton" onclick="searchProducts()">Buscar</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!--inicio catalago-->
  <div class="py-5 bg-light border-top">
    <h1>Catalago</h1>
    <br>
    <br>

    <!--Filtro de busqueda-->
    <div class="center-container">
      <div class="filter-container">
        <label for="filter">Ordenar por:</label>
        <select id="filter">
          <option value="default">Predeterminado</option>
          <option value="asc">Orden alfabético ascendente</option>
          <option value="desc">Orden alfabético descendente</option>
          <option value="price-asc">Precio ascendente</option>
          <option value="price-desc">Precio descendente</option>
        </select>
      </div>
    </div>    
    <div class="container">
      <section>
         <div class="row">
            <main id="catalogoProductos" class="col-sm-6 row"></main>            
            <!-- Carrito -->
            <aside class="col-sm-6">
                <h2>Carrito</h2>
                <!-- Elementos del carrito -->
                <ul id="carrito" class="list-group"></ul>
                <hr>
                <!-- Precio total -->
                <p class="text-right">Total: &dollar;<span id="total"></span></p>
                <button id="boton-vaciar" class="btn btn-danger">Vaciar</button>              
                <button class="btn btn-primary" id="obtenerCotizacionBtn">Obtener Cotización</button>
                <a class="btn btn-primary" href="https://www.paypal.com">Pagar</a>
                <table id="cotizacion" class="table table-bordered"></table>    
            </aside>        
         </div>
      </section>
    </div>
  </div>

  <br>

  <!--Modal para CRUD-->

  </div>


  <footer class="container-fluid py-5 my-5 border-top" style="background-color: rgb(133, 71, 122);">
    <div class="row justify-content-center">
      <div class="col-12 col-md-3 order-2 order-md-1 text-center">
        <small class="d-block text-light">© 2022-2023 MisLindasChacharas</small>
      </div>
      <div class="col-6 col-md-3 order-1 order-md-2 text-center">
        <h5 class="text-light">Características</h5>
        <ul class="list-unstyled text-small">
          <li><a class="text-muted-light" style="color: white;">Buenos</a></li>
          <li><a class="text-muted-light" style="color: white;">Bonitos</a></li>
          <li><a class="text-muted-light" style="color: white;">Baratos</a></li>
          <li><a class="text-muted-light" style="color: white;">Disponibles</a></li>

        </ul>
      </div>
      <div class="col-6 col-md-3 order-1 order-md-2 text-center">
        <h5 class="text-light">Contactanos</h5>
        <ul class="list-unstyled text-small">
          <li><a href="https://www.facebook.com/Mis.Lindas.Chacharas" class="text-light" title="facebook">Facebook</a>
          </li>

          <li><a href="https://www.instagram.com/mislindaschacharas/" class="text-light" title="instagram">Instagram</a>
          </li>
          <li><a class="text-light">MisLindasChacharas@gmail.com</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <script src="vista/sombras.js"></script>
  <script src="vista/mascarillas.js"></script>
  <script src="Productos.json"></script>
  <script src="https://www.gstatic.com/firebasejs/7.15.0/firebase.js"></script>
  <script
    src="https://www.paypal.com/sdk/js?client-id=AWp5XLwAVcsjPx07ujiuwdrF71xDEZLA6wZ9BJbLND0feaTnYRn8RlRqdrkhqAf14chFoPzkuB6Odb3U">
  </script>
  <script>    
    let carrito = [];
    const divisa = '$';
    const DOMcarrito = document.querySelector('#carrito');
    const DOMtotal = document.querySelector('#total');
    const DOMbotonVaciar = document.querySelector('#boton-vaciar');     
    var firebaseConfig = {
      apiKey: "AIzaSyBI0cViactxg-q1o6tPvTfXPFxyKvCIwAg",
      authDomain: "chacharas-c6ec7.firebaseapp.com",
      databaseURL: "https://chacharas-c6ec7-default-rtdb.firebaseio.com",
      projectId: "chacharas-c6ec7",
      storageBucket: "chacharas-c6ec7.appspot.com",
      messagingSenderId: "707214837038",
      appId: "1:707214837038:web:fa947fe910e5ef905ae6bf",
      measurementId: "G-R340PVF1GK"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const productosRef = db.ref('productos');
    productosRef.once('value', function (snapshot) {
      snapshot.forEach(function (childSnapshot) {
        var producto = childSnapshot.val();
        // Aquí puedes realizar alguna acción con los datos del producto
        console.log(producto);
        console.log('Identificador del producto:', producto.identificador);
      });
    });
    const catalogoProductos = document.getElementById('catalogoProductos');
    productosRef.once('value', function (snapshot) {
      snapshot.forEach(function (childSnapshot) {
        var producto = childSnapshot.val();
        // Genera el HTML correspondiente para cada producto
        var productoHTML = `
        <div class="col-12 col-sm-8 col-md-4">
          <div class="card mb-4 align-items-center">
              <div id="diseño">
                <div id="tit">
                    <img src=${producto.imagen} style="width: 150px;" title=${producto.nombre} alt=${producto.nombre}>
                    <br>
                    <h5>${producto.nombre}</h5>
                    <p class="card-price" data-precio="35.00">$${producto.precio}</p>
                    <a href="javascript:void(0)" class="btn btn-primary" onclick="anyadirProductoAlCarrito('${producto.identificador}')">Agregar al carrito</a>

                </div>
                <a href="${producto.nombre}.html" title="aretegirasol"><button class="btn btn-sm btn-outline-secondary" id="cyn">Ir</button></a>
            </div>
          </div>
        </div>
        `;
        catalogoProductos.innerHTML += productoHTML;         
        // Variables para el carrito
        const db = firebase.database();
        const carritoRef = db.ref('carrito');
        // Función para realizar la solicitud y actualizar la tabla
        let datosCargados = false; // Bandera para rastrear si los datos ya se han cargado
        async function obtenerCotizacion() {
          console.log('Llamada a obtenerCotizacion()'); // Registro para ver cuántas veces se llama a la función

          if (datosCargados) {
            console.log('Los datos de la cotización ya se han cargado');
            return;
          }

          console.log('Procediendo a actualizar la tabla de cotización');
          const tablaCotizacion = document.getElementById('cotizacion');
          eliminarNodoCotizacion(); // Revisa qué hace esta función
          crearNuevoNodoCotizacion(); // Revisa qué hace esta función
          tablaCotizacion.innerHTML = '';

          const encabezado = document.createElement('tr');
          encabezado.innerHTML = `
            <th>Alias</th>
            <th>Cantidad</th>
            <th>Moneda</th>
            <th>Fecha de Entrega</th>
            <th>Servicio</th>
            <th>Acción</th>
          `;
          tablaCotizacion.appendChild(encabezado);

          try {
            const response = await fetch('/api/data');
            const data = await response.json();

            if (data && typeof data === 'object' && !Array.isArray(data)) {
              const fila = document.createElement('tr');
              fila.innerHTML = `
                <td>${data.alias}</td>
                <td>${data.amount}</td>
                <td>${data.currency}</td>
                <td>${data.deliveryTimestamp}</td>
                <td>${data.serviceName}</td>
                <td><input type="radio" name="productoSeleccionado" onclick="anyadirEnvioAlCarrito(${data.amount})"></td>
              `;
              tablaCotizacion.appendChild(fila);
              datosCargados = true; // Establecer la bandera para indicar que los datos se han cargado
            } else {
              console.log('Los datos de la API no son un objeto válido');
            }
          } catch (error) {
            console.error('Error al obtener la cotización:', error);
          }
        }
        //Crea el nodo de cotizacion para usar los datos de ese nodo a la API
        function crearNuevoNodoCotizacion() {
          carritoRef.once('value').then((carritoSnapshot) => {
            const carritoActual = carritoSnapshot.val() || {};
            let sumaAltura = 0;
            let sumaAncho = 0;
            let sumaLongitud = 0;
            let sumaPeso = 0;
            // Recorre los productos en el carrito y suma sus precios, altura, ancho, longitud y peso
            for (const productId in carritoActual) {
              if (carritoActual.hasOwnProperty(productId)) {
                const producto = carritoActual[productId];
                sumaAltura += producto.altura;
                sumaAncho += producto.ancho;
                sumaLongitud += producto.longitud;
                sumaPeso += producto.peso * producto.cantidad;
              }
            }
            // Crea un nuevo objeto con las sumas totales
            const nuevoNodoCotizacion = {
              altura: sumaAltura.toFixed(2),
              ancho: sumaAncho.toFixed(2),
              longitud: sumaLongitud.toFixed(2),
              peso: sumaPeso.toFixed(2)
            };
            // Utiliza una clave fija para el nodo de cotización (en este caso, "1")
            const claveCotizacion = '1';
            // Crea o actualiza el nodo "cotizacion" con las sumas totales y la clave específica
            const actualizacion = {};
            actualizacion[`/cotizacion/${claveCotizacion}`] = nuevoNodoCotizacion;
            db.ref().update(actualizacion);
          });
        }
        //Elimina el nodo para usarlo de forma especial siempre que se presione el boton
        function eliminarNodoCotizacion() {
          // Obtener la referencia del nodo "cotizacion"
          const cotizacionRef = db.ref('cotizacion');

        // Utilizar una promesa para manejar la operación de eliminación
        return cotizacionRef.remove()
          .then(() => {
            console.log("Nodo 'cotizacion' eliminado exitosamente");
          })
          .catch((error) => {
            console.error("Error al eliminar el nodo 'cotizacion':", error);
          });
        }
        document.getElementById('obtenerCotizacionBtn').addEventListener('click', obtenerCotizacion);
      })      
      // Variables para el carrito
      const db = firebase.database();
      const productosRef = db.ref('productos');
      const carritoRef = db.ref('carrito');
      /*Añade los productos al carrito*/
      function anyadirProductoAlCarrito(identificador) {
        console.log("Identificador del producto:", identificador);
        // Convertir el identificador a entero
        const idProducto = parseInt(identificador);
        // Convertir el identificador a cadena para comparaciones seguras
        const idProductoStr = String(idProducto);
        productosRef.orderByChild('identificador').equalTo(idProducto).once('value', function (snapshot) {
          const productoKey = Object.keys(snapshot.val())[0];
          const producto = snapshot.val()[productoKey];
          if (producto) {
                // Obtener el nodo "carrito" de la base de datos
                carritoRef.once('value', function (carritoSnapshot) {
                    const carritoActual = carritoSnapshot.val() || {};

                    // Verificar si el producto ya está en el carrito
                    if (carritoActual[idProductoStr]) {
                        carritoActual[idProductoStr].cantidad += 1;
                        carritoActual[idProductoStr].altura += carritoActual[idProductoStr].altura;
                        carritoActual[idProductoStr].peso += carritoActual[idProductoStr].peso;
                    } else {
                        // Si no está, agregarlo con una cantidad de 1
                        carritoActual[idProductoStr] = {
                            nombre: producto.nombre || "", // Aseguramos que el nombre no sea undefined
                            precio: producto.precio || 0,   // Aseguramos que el precio no sea undefined
                            altura: producto.altura || 0,
                            ancho: producto.ancho || 0,
                            longitud: producto.longitud || 0,
                            peso: producto.peso || 0,
                            cantidad: 1
                        };
                    }

                    // Actualizar el nodo "carrito" en Firebase
                    carritoRef.set(carritoActual);

                    // Renderizar el carrito (esto puede ser llamado después de set, dependiendo de tus necesidades)
                    renderizarCarrito();
                });
            } 
            else {
              console.error('Producto no encontrado:', idProducto);
                // Manejar la ausencia del producto, por ejemplo, mostrar un mensaje al usuario
            }
        });
      }
      //Este es una funcion especial para el envio
      function anyadirEnvioAlCarrito(amount) {
        
        console.log("Añadiendo producto al carrito con datos:", amount);

        // Utilizar un identificador único para el producto "Envío"
        const idProductoStr = "envio";

        carritoRef.once('value', function (carritoSnapshot) {
          const carritoActual = carritoSnapshot.val() || {};

          // Verificar si el producto "Envío" ya está en el carrito
          if (carritoActual[idProductoStr]) {
            carritoActual[idProductoStr].cantidad += 1; // Aumentar la cantidad si ya existe
          } else {
            // Si no está, agregarlo con los datos específicos
            carritoActual[idProductoStr] = {
              nombre: "Envío",
              precio: amount || 0,
              altura: 0,
              ancho: 0,
              longitud: 0,
              peso: 0,
              cantidad: 1
            };
          }

          // Actualizar el nodo "carrito" en Firebase
          carritoRef.set(carritoActual);

          // Llamar a renderizarCarrito() si es necesario
          renderizarCarrito();
        });
      }

      /*Dibuja todos los productos guardados en el carrito*/
      function renderizarCarrito() {
        // Vaciamos todo el html
        DOMcarrito.textContent = '';

        // Obtener el nodo "carrito" de la base de datos
        carritoRef.once('value', function (carritoSnapshot) {
            const carritoActual = carritoSnapshot.val() || {};

            // Iterar sobre los productos en el carrito
            Object.keys(carritoActual).forEach((item) => {
                const producto = carritoActual[item];

                // Cuenta el número de veces que se repite el producto
                const numeroUnidadesItem = producto.cantidad;
                
                const Total = producto.precio*numeroUnidadesItem;

                // Creamos el nodo del item del carrito
                const miNodo = document.createElement('li');
                miNodo.classList.add('list-group-item', 'text-right', 'mx-2');
                miNodo.textContent = `${numeroUnidadesItem} x ${producto.nombre} - ${divisa}${Total}`;

                // Boton de borrar
                const miBoton = document.createElement('button');
                miBoton.classList.add('btn', 'btn-danger', 'mx-5');
                miBoton.textContent = 'X';
                miBoton.style.marginLeft = '1rem';
                miBoton.dataset.item = item;
                miBoton.addEventListener('click', borrarItemCarrito);

                // Mezclamos nodos
                miNodo.appendChild(miBoton);
                DOMcarrito.appendChild(miNodo);
            });

            // Renderizamos el precio total en el HTML
            DOMtotal.textContent = calcularTotal();
            // En otro lugar donde necesites mostrar el total, maneja la promesa:
            calcularTotal().then((total) => {
                DOMtotal.textContent = `Total: ${divisa}${total}`;
            }).catch((error) => {
                console.error('Error al obtener el total:', error);
            });
        });
      } 
      /*Evento para borrar un elemento del carrito*/
      function borrarItemCarrito(evento) {
        // Obtenemos el producto ID que hay en el botón pulsado
        const id = evento.target.dataset.item;
        // Actualiza el nodo "carrito" en Firebase para eliminar el producto con el identificador proporcionado
        carritoRef.once('value', function (carritoSnapshot) {
            const carritoActual = carritoSnapshot.val() || {};
            // Verificar si el producto está en el carrito
            if (carritoActual[id]) {
                // Si está, lo eliminamos
                delete carritoActual[id];
                // Actualizamos el nodo "carrito" en Firebase
                carritoRef.set(carritoActual);
                // Volvemos a renderizar
                renderizarCarrito();
            }
        });
      }
      /*Calcula el precio total teniendo en cuenta los productos repetidos*/
      function calcularTotal() {
        // Calcula el total sumando los precios de los productos en el carrito
        return carritoRef.once('value').then((carritoSnapshot) => {
            const carritoActual = carritoSnapshot.val() || {};
            let total = 0;

            // Recorre los productos en el carrito y suma sus precios
            for (const productId in carritoActual) {
                if (carritoActual.hasOwnProperty(productId)) {
                    total += carritoActual[productId].precio * carritoActual[productId].cantidad;
                }
            }
            return total.toFixed(2);
        });
      }
      /*Varia el carrito y vuelve a dibujarlo*/
      function vaciarCarrito() {
        // Borrar todos los registros del nodo "carrito"
        carritoRef.remove()
            .then(() => {
                // Renderizamos los cambios después de borrar en la base de datos
                renderizarCarrito();
            })
            .catch((error) => {
                console.error('Error al vaciar el carrito en la base de datos:', error);
            });
      }
      // Eventos
      DOMbotonVaciar.addEventListener('click', vaciarCarrito);
      // Inicio
      renderizarCarrito();
      // Agrega esto al final del script
      window.anyadirProductoAlCarrito = anyadirProductoAlCarrito;
      window.anyadirEnvioAlCarrito = anyadirEnvioAlCarrito;
    });
  </script>
</body>
</html>
</html>
